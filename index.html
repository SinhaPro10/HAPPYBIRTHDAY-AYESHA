<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Happy Birthday AYESHA 🎂</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
  
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
  <!-- Confetti.js -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto Slab', serif;
      background: linear-gradient(135deg, #fff0f5, #ffd1dc);
      color: #c71585;
      overflow-x: hidden;
      text-align: center;
      min-height: 100vh;
      position: relative;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff0f5;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      font-weight: 700;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    .container {
      display: none;
      padding: clamp(15px, 4vw, 30px);
      max-width: 100%;
      margin: 0 auto;
    }

    h1 {
      font-family: 'Poppins', sans-serif;
      font-size: clamp(1.5rem, 6vw, 2.5rem);
      margin-bottom: 15px;
      color: #d81b60;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .typing-text {
      font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      max-width: 95%;
      margin: 20px auto;
      white-space: pre-line;
      line-height: 1.6;
      color: #333;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .collage {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin: 30px 0;
      padding: 0 5px;
    }

    .collage img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(255, 105, 180, 0.3);
      transition: transform 0.3s ease;
    }

    @media (hover: none) {
      .collage img:hover {
        transform: none;
      }
    }

    .cake-container {
      perspective: 800px;
      margin: 30px auto;
    }

    .cake {
      position: relative;
      width: clamp(120px, 40vw, 160px);
      height: clamp(150px, 50vw, 200px);
      background: linear-gradient(#ffccd5, #ffb6c1);
      border-radius: 0 0 20px 20px;
      box-shadow: 0 8px #ff6f91;
      margin: 0 auto;
      transition: transform 0.3s ease;
    }

    .cake::before {
      content: '';
      position: absolute;
      top: clamp(-30px, -10vw, -35px);
      left: 0;
      width: 100%;
      height: clamp(40px, 15vw, 50px);
      background: #fff0f0;
      border-radius: 50%;
      border: 5px solid #ff6f91;
    }

    .candle {
      position: absolute;
      top: clamp(-50px, -15vw, -60px);
      left: 50%;
      transform: translateX(-50%);
      width: clamp(10px, 3vw, 12px);
      height: clamp(40px, 12vw, 50px);
      background: #e6005c;
      border-radius: 3px;
    }

    .flame {
      position: absolute;
      top: clamp(-70px, -20vw, -80px);
      left: 50%;
      width: clamp(16px, 5vw, 20px);
      height: clamp(16px, 5vw, 20px);
      background: radial-gradient(circle, #ffd700, #ff8c00);
      border-radius: 50%;
      transform: translateX(-50%);
      animation: flicker 0.4s infinite alternate;
      transition: opacity 0.5s ease;
    }

    @keyframes flicker {
      0% { transform: translateX(-50%) scale(1); opacity: 1; }
      100% { transform: translateX(-50%) scale(1.15); opacity: 0.85; }
    }

    button {
      padding: clamp(10px, 3vw, 12px) clamp(25px, 6vw, 30px);
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      background: #ff69b4;
      border: none;
      border-radius: 25px;
      color: white;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(255, 105, 180, 0.3);
      transition: background 0.3s, transform 0.2s;
      margin: 10px;
      touch-action: manipulation;
      min-width: 120px;
    }

    button:hover {
      background: #ff1493;
      transform: translateY(-2px);
    }

    button:focus {
      outline: 2px solid #ff1493;
      outline-offset: 2px;
    }

    @media (hover: none) {
      button:hover {
        background: #ff69b4;
        transform: none;
      }
    }

    #musicBtn.playing::after {
      content: "🔊 Pause Music";
    }

    #musicBtn:not(.playing)::after {
      content: "🔇 Play Music";
    }

    #sparkles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .hearts {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }

    @keyframes fall {
      0% { transform: translateY(-10vh); opacity: 1; }
      100% { transform: translateY(100vh); opacity: 0; }
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      h1 {
        font-size: clamp(1.2rem, 5vw, 2rem);
      }

      .typing-text {
        font-size: clamp(0.8rem, 2.2vw, 0.95rem);
        line-height: 1.5;
      }

      .collage {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
      }

      .collage img {
        border-radius: 8px;
      }

      button {
        padding: 10px 20px;
        font-size: clamp(0.85rem, 2.2vw, 0.9rem);
        min-width: 100px;
      }
    }
  </style>
</head>

<body>
  <div id="loading">Loading Your Surprise...</div>

  <div class="container">
    <h1>🎂 Happy Birthday AYESHA! 🎂</h1>

    <div class="cake-container">
      <div class="cake">
        <div class="candle"></div>
        <div class="flame" id="flame"></div>
      </div>
    </div>

    <button onclick="startCelebration()" aria-label="Blow out the birthday candle">Blow Out Candle 🎂</button>

    <audio id="bg-music" loop preload="auto">
      <source src="https://file.garden/aBmv9ZdbGjS8LzMc/Teri-Meri%20Reprise%20%20Bodyguard%20%20Music%20Re%20Enhanced%20%20With%20Stereo%20%26%20Base%20%20@FeelTheBeat.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <button id="musicBtn" onclick="toggleMusic()" aria-label="Toggle background music"></button>

    <div class="typing-text" id="typedText"></div>

    <div class="collage">
      <img src="https://i.imgur.com/7iR8K6p.png" alt="Birthday cake" loading="lazy">
      <img src="https://i.imgur.com/lMoReZR.png" alt="Memory photo 1" loading="lazy">
      <img src="https://i.imgur.com/FubZfbl.jpeg" alt="Memory photo 2" loading="lazy">
      <img src="https://i.imgur.com/W2L5kNv.jpeg" alt="Memory photo 3" loading="lazy">
      <img src="https://i.imgur.com/wqdtsq8.jpeg" alt="Memory photo 4" loading="lazy">
    </div>

    <canvas id="sparkles"></canvas>
    <div class="hearts" id="hearts"></div>
  </div>

  <script>
    // Message (unchanged)
    const message = `🌸💖 To My Boujaan, My AYESHA 💖🌸

... "To the girl who carries quiet storms and still shines." — Pakhi

Pakhi,
I know Pakhi tumi maybe eita peye khusi teh lafaitaso. Asol-e English e lekhte gele hoyto onek somoy fully moner True feelings gulo express korte parbo nah, abar Bangla lekhar moto dhorjo o nai karon ei kotha gulo amr boujaan keh dite jacchi, jeh moner kotha gulo lafay lafay astase.

Jak jak, sharen ei sob.
Ajke kotto khusi er din amar, janen apni?
Jani jani, amr sweet depressing girl tah tar birthday ke posondo kore nah. Apnar kase hajar reasons ase ajker din tah sad thakar... but ami tomake ekta reason dite chai.

Ayesha, ami asi ekhon tomar pase.
Ami asi — ar keu thakuk ba na thakuk.

Ayesha, amar pase, amar kache tumi thakle, amar ar kau ke dorkar hobe nah.
Tumi e amar kache amar sobche dami jinis, amar jinis, amar manus.
Apni amar, amar Ayesha. Tumi bujso?

Ar manus ki mone kore tomake, tomake ke koto tuku value dey ba kisu, ami jante chai nah.
Ami sudhu buji, tumi amar.
Ar amar kache tumi amar sobche dami kisu — jeta sara amar life ochol.
Bujso?

So, eita shune, eita buje khusi hon —
Je apnar priyo manus-er kache apni tar priyo manus.

Amar kache janen, apnake compliments deyar moto onek kisui ase, kintu dibo nh.
Maje maje jano lage tomar compliment deyar por o feel kori jeh amar feelings gulo express korte pari nai —
Tomake jei bisoy gulor jonno compliments dei, shei gular fully expression hoy na.

But Ayesha —
"I can die for your smile."

Tomake jokhon dekhi amar pase bose hascho, amar dike takiye, jano moner maje ekta satisfaction kaj kore —
Jeh AMI amar AYESHA-ke happy korte parchi, amar AYESHA amar karone smile korche.
Kase ei feeling tah onek bhalo lage.

Ayesha, I am happy to have you in my life.
Darling, you are the precious person to me.
Jani na, tomar jaygay onno keu thakle eto kosto kore, hazar line er code likhe, eto kichu kortam kina.

Amar life e eshe, amar life take eto sundor kore deyar jonno apnake thanks.
So, ekhon toh nijer jonmo tah niye happy hon?

Tumi amar life ke notun shopno, notun alo diye bhore diyecho.
Thank you, my Boujaan.

Tai aj tomar jonmo niyeo, ami chai tumi nijeke niye khushi hou.

🌸💖 At the End 💖🌸

🎂 HAPPY BIRTHDAY AYESHA! 🎂
🎉 HAPPY BIRTHDAY MY LOVE! 🎉
🌟 HAPPY FIRST BIRTHDAY WITH ME! 🌟

Let's start a beautiful future together —
Ki bolen?

🤝 Amar haat dhore agaben?
Amar Behula. 💖... 
`;

    // Initialize with timeout fallback
    window.onload = () => {
      const loadingTimeout = setTimeout(() => {
        try {
          gsap.to('#loading', {
            opacity: 0,
            duration: 0.5,
            onComplete: () => {
              document.getElementById('loading').style.display = 'none';
              document.querySelector('.container').style.display = 'block';
              initAnimations();
              typeMessage();
            }
          });
        } catch (e) {
          console.error('Initialization failed:', e);
          document.getElementById('loading').textContent = 'Error loading page. Please refresh.';
        }
      }, 1000);

      // Preload critical resources
      const resources = [
        'https://file.garden/aBmv9ZdbGjS8LzMc/Teri-Meri%20Reprise%20%20Bodyguard%20%20Music%20Re%20Enhanced%20%20With%20Stereo%20%26%20Base%20%20@FeelTheBeat.mp3',
        'https://i.imgur.com/7iR8K6p.png'
      ];
      resources.forEach(src => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = src;
        link.as = src.endsWith('.mp3') ? 'audio' : 'image';
        document.head.appendChild(link);
      });
    };

    // GSAP Animations (simplified)
    function initAnimations() {
      try {
        gsap.from('h1', { y: -30, opacity: 0, duration: 0.8, ease: 'power3.out' });
        gsap.from('.cake', { scale: 0.9, opacity: 0, duration: 1, ease: 'elastic.out(1, 0.5)', delay: 0.3 });
        gsap.from('button', { y: 15, opacity: 0, duration: 0.6, stagger: 0.15, ease: 'power2.out', delay: 0.8 });
        gsap.from('.collage img', { y: 30, opacity: 0, duration: 0.8, stagger: 0.1, ease: 'power2.out', delay: 1 });
      } catch (e) {
        console.error('Animation error:', e);
      }
    }

    // Typing Animation
    let index = 0;
    function typeMessage() {
      try {
        if (index < message.length) {
          document.getElementById('typedText').textContent += message.charAt(index);
          if (index === 0) gsap.to('.typing-text', { opacity: 1, duration: 0.4 });
          index++;
          setTimeout(typeMessage, 20);
        } else {
          gsap.to(window, { scrollTo: { y: document.body.scrollHeight, autoKill: false }, duration: 1.5, ease: 'power2.inOut' });
        }
      } catch (e) {
        console.error('Typing error:', e);
      }
    }

    // Celebration
    function startCelebration() {
      try {
        gsap.to('#flame', { opacity: 0, duration: 0.4 });
        createSparkles();
        createHearts();
        triggerConfetti();
      } catch (e) {
        console.error('Celebration error:', e);
      }
    }

    // Sparkles (reduced particles)
    function createSparkles() {
      const canvas = document.getElementById('sparkles');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];

      const particleCount = window.innerWidth < 600 ? 30 : 50; // Further reduced
      for (let i = 0; i < particleCount; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2 + 1,
          speedX: (Math.random() - 0.5) * 1.2,
          speedY: Math.random() * 1.2 + 0.3,
          color: `hsl(${Math.random() * 360}, 100%, 80%)`
        });
      }

      function animate() {
        try {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          for (let p of particles) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            p.y += p.speedY;
            p.x += p.speedX;
            if (p.y > canvas.height) p.y = 0;
            if (p.x > canvas.width || p.x < 0) p.speedX *= -1;
          }
          requestAnimationFrame(animate);
        } catch (e) {
          console.error('Sparkles animation error:', e);
        }
      }
      animate();
    }

    // Hearts (reduced)
    function createHearts() {
      const heartsContainer = document.getElementById('hearts');
      const heartCount = window.innerWidth < 600 ? 5 : 8;
      for (let i = 0; i < heartCount; i++) {
        const heart = document.createElement('div');
        heart.innerHTML = '💖';
        heart.style.position = 'absolute';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.top = '-10vh';
        heart.style.fontSize = Math.random() * 20 + 10 + 'px';
        heart.style.animation = `fall ${Math.random() * 2.5 + 1.5}s linear forwards`;
        heartsContainer.appendChild(heart);
        setTimeout(() => heart.remove(), 4000);
      }
    }

    // Confetti (reduced)
    function triggerConfetti() {
      try {
        confetti({
          particleCount: window.innerWidth < 600 ? 50 : 100,
          spread: 60,
          origin: { y: 0.6 },
          colors: ['#ff69b4', '#ffd700', '#ff1493', '#fff0f5']
        });
      } catch (e) {
        console.error('Confetti error:', e);
      }
    }

    // Music Control
    const music = document.getElementById('bg-music');
    const musicBtn = document.getElementById('musicBtn');
    let isPlaying = false;

    function toggleMusic() {
      try {
        if (isPlaying) {
          gsap.to(music, { volume: 0, duration: 0.4, onComplete: () => music.pause() });
          musicBtn.classList.remove('playing');
        } else {
          music.volume = 0;
          music.play().catch((e) => {
            console.warn('Audio playback failed:', e);
            musicBtn.textContent = '🔇 Audio Unavailable';
          });
          gsap.to(music, { volume: 1, duration: 0.4 });
          musicBtn.classList.add('playing');
        }
        isPlaying = !isPlaying;
      } catch (e) {
        console.error('Music toggle error:', e);
      }
    }

    // Parallax (only for non-touch devices)
    if (!('ontouchstart' in window)) {
      window.addEventListener('mousemove', (e) => {
        try {
          const cake = document.querySelector('.cake');
          const x = (e.clientX / window.innerWidth - 0.5) * 15;
          const y = (e.clientY / window.innerHeight - 0.5) * 15;
          gsap.to(cake, { rotationY: x, rotationX: -y, duration: 0.4, ease: 'power2.out' });
        } catch (e) {
          console.error('Parallax error:', e);
        }
      });
    }

    // Touch Support
    document.querySelector('button[onclick="startCelebration()"]').addEventListener('touchstart', startCelebration);

    // Keyboard Accessibility
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && document.activeElement.tagName !== 'BUTTON') {
        startCelebration();
      }
    });

    // Handle Resize
    window.addEventListener('resize', () => {
      const canvas = document.getElementById('sparkles');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
